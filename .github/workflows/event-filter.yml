name: 03. Event Filters Demo

on:
  push:
    branches: [main, develop]
    paths: -"src/**"
      -"!docs/**"

  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened, closed]
    paths:
      - "src/**"
      - "public/**"
      - "package.json"

  workflow_dispatch:

jobs:
  event-info:
    name: ì´ë²¤íŠ¸ ì •ë³´ ì¶œë ¥
    runs-on: ubuntu-latest

  branch-specific:
    name: ë¸Œëœì¹˜ë³„ ë™ì‘
    runs-on: ubuntu-latest
    needs: event-info

    steps:
      - name: Checkout code
        uses: actions/checkout@4

        # main ë¸Œëœì¹˜ ì „ìš©
      - name: Main branch actions
        if: github.ref_name == 'main'
        run: |
          echo "ë©”ì¸ ë¸Œëœì¹˜ ì „ìš© ì‘ì—…"

        # develop ë¸Œëœì¹˜ ì „ìš©
      - name: Develop branch actions
        if: github.ref_name == 'develop'
        run: |
          echo "ğŸ”§ Develop ë¸Œëœì¹˜ ì „ìš© ì‘ì—…"

  event-type-handling:
    name: ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬
    runs-on: ubuntu-latest
    needs: event-info

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Handle push event
        if: github.event_name == 'push'
        run: |
          echo "ğŸ“¤ Push ì´ë²¤íŠ¸ ì²˜ë¦¬"
          echo "ì»¤ë°‹ ë©”ì‹œì§€: ${{ github.event.head_commit.message }}"
          echo "ì»¤ë°‹ ì‘ì„±ì: ${{ github.event.head_commit.author.name }}"

          # Pull Request ì´ë²¤íŠ¸ ì²˜ë¦¬
      - name: Handle pull request event
        if: github.event_name == 'pull_request'
        run: |
          echo "ğŸ“ Pull Request ì´ë²¤íŠ¸ ì²˜ë¦¬"
          echo "PR ë²ˆí˜¸: ${{ github.event.pull_request.number }}"
          echo "PR ì œëª©: ${{ github.event.pull_request.title }}"
          echo "PR ì•¡ì…˜: ${{ github.event.action }}"

    # 4. ì¡°ê±´ë¶€ ì‘ì—… ì‹¤í–‰
    conditional-tasks:
      name: ì¡°ê±´ë¶€ ì‘ì—… ì‹¤í–‰
      runs-on: ubuntu-latest
      needs: [event-info, branch-specific, event-type-handling]

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        # main ë¸Œëœì¹˜ + push ì´ë²¤íŠ¸ ì‹œì—ë§Œ ì‹¤í–‰
        - name: Production deployment
          if: github.ref_name == 'main' && github.event_name == 'push'
          run: |
            echo "ğŸš€ Production ë°°í¬ ì‹¤í–‰"
            echo "ë©”ì¸ ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ì–´ ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤"

        # Pull Request + main ë¸Œëœì¹˜ ì‹œì—ë§Œ ì‹¤í–‰
        - name: PR review checks
          if: github.event_name == 'pull_request' && github.event.pull_request.base.ref == 'main'
          run: |
            echo "ğŸ” Main ë¸Œëœì¹˜ PR ë¦¬ë·° ì²´í¬"
            echo "ì½”ë“œ ë¦¬ë·° ìš”êµ¬ì‚¬í•­ í™•ì¸ ì¤‘..."
